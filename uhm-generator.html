---
layout: null
---
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UHM Generator (Hive 2)</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Menlo&display=swap" rel="stylesheet">

    <!-- Custom Head (Sidebar/Theme) -->
    {% include head-custom.html %}

    <style>
        :root {
            --bg-color: #1e1e1e;
            --card-bg: #252525;
            --text-color: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent-color: #8cc63f;
            /* Zebra-ish green */
            --accent-hover: #7ab332;
            --input-bg: #2a2a2a;
            --border-color: #333333;
            --code-bg: #111111;
            --error-bg: rgba(220, 38, 38, 0.2);
            --error-border: rgba(185, 28, 28, 0.5);
            --error-text: #fecaca;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            padding-left: calc(250px + 2rem);
            /* Offset for pinned sidebar (250px) */
        }

        @media (max-width: 1024px) {
            body {
                padding-left: 2rem;
            }
        }

        .container {
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #fff, var(--accent-color));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        p.subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }



        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        input[type="password"],
        textarea {
            width: 100%;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: white;
            padding: 1rem;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        textarea {
            height: 120px;
            resize: vertical;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(140, 198, 63, 0.2);
        }

        button.primary-btn {
            background-color: var(--accent-color);
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s, opacity 0.2s;
            align-self: center;
            width: 100%;
            max-width: 300px;
        }

        button.primary-btn:hover:not(:disabled) {
            background-color: var(--accent-hover);
        }

        button.primary-btn:disabled {
            background-color: #444;
            color: #888;
            cursor: not-allowed;
        }

        .error-box {
            background-color: var(--error-bg);
            border: 1px solid var(--error-border);
            color: var(--error-text);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            display: none;
            /* hidden by default */
        }

        .result-section {
            display: none;
            /* hidden by default */
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        pre {
            background-color: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            color: #dcdcdc;
            border: 1px solid var(--border-color);
            white-space: pre-wrap;
        }

        .actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        button.secondary-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        button.secondary-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 3px solid rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            border-top-color: #000;
            animation: spin 1s ease-in-out infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div>
            <h1>UHM Generator (Hive 2)</h1>
            <p class="subtitle">Generate complex wavetables for u-he Hive 2 using natural language. This tool runs
                locally on your GPU.</p>
            <p class="subtitle" style="margin-top: 0.5rem; font-size: 0.9em; opacity: 0.8;">Client-side AI generation.
                No server. No API keys. Powered by your GPU.</p>
        </div>

        <div class="card">
            <!-- Init Section (Simulated "Download Engine") -->
            <div id="init-section" style="text-align: center;">
                <p style="margin-bottom: 1rem;">This mode downloads a 2.3GB AI model (Phi-3) directly to your browser
                    cache. It runs locally on your GPU.</p>
                <button id="init-btn" class="primary-btn" onclick="initEngine()">Initialize AI Engine (Download
                    Required)</button>
            </div>

            <div id="status-container" class="status-box" style="display:none;">
                <div id="params-status">Status: Ready to initialize...</div>
                <div id="download-progress"></div>
            </div>

            <!-- Generator Interface (Hidden until Init) -->
            <div id="generator-interface" style="display:none; flex-direction:column; gap:1.5rem;">
                <!-- Prompt Input -->
                <div class="input-group">
                    <label for="prompt">Describe your wavetable</label>
                    <textarea id="prompt"
                        placeholder="e.g., A deep neuro bass that evolves from a sine wave into a chaotic metallic scream using phase distortion..."></textarea>
                </div>

                <button id="generateBtn" class="primary-btn" onclick="generateUhm()">
                    <span id="btnText">Generate .uhm Script</span>
                </button>

                <!-- Error Box -->
                <div id="errorBox" class="error-box"></div>

                <!-- Result Section -->
                <div id="resultSection" class="result-section">
                    <div class="actions">
                        <button class="secondary-btn" onclick="copyToClipboard()">Copy Code</button>
                        <button class="secondary-btn" onclick="downloadUhm()">Download .uhm</button>
                    </div>
                    <pre id="codeOutput"></pre>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";

        // --- CONSTANTS ---
        const SELECTED_MODEL = "Phi-3-mini-4k-instruct-q4f16_1-MLC";
        let engine = null;

        const UHM_REFERENCE_LIBRARY = `
======================================================================
REFERENCE LIBRARY (OFFICIAL MANUAL EXAMPLES)
======================================================================
Use these validated patterns from the u-he Hive Wavetable Manual.

EXAMPLE 1: "Synced Square Wave" (Logic & Frac)
// Emulate a synced square wave using fractal phase reset
NumFrames = 256
Wave "-1 + 2 * (frac(phase*(7*table+1)) > 0.5)"
Spectrum lowest=0 highest=0 "0"
Normalize base=each

EXAMPLE 2: "DSP Filtered Sawtooth" (Lowpass Function)
// Create a lowpass filtered sawtooth where cutoff modulates with table
NumFrames = 256
// lowpass(input, cutoff, resonance)
Wave "lowpass(2*phase-1, table+0.1, 0.5)"
Spectrum lowest=0 highest=0 "0"
Normalize base=each

EXAMPLE 3: "Envelope Shaping" (Envelope Command)
// Use an envelope to create a sweet-sounding "fin" triangle
NumFrames = 100
// Define 8-segment envelope: Time(0-1) vs Level
Envelope curve=exponential L0=0 T1=0.25 L1=1 T2=0.5 L2=-1 T3=0.25 L4=0
Wave "env(phase)"
Spectrum lowest=0 highest=0 "0"
Normalize base=each

EXAMPLE 4: "Spectral Triangle" (Mathematical Series)
// Creating a triangle wave via additive synthesis formula
NumFrames = 1
Spectrum "1/(index*index)*((index % 2)==1)*(1-2*((index % 4)==3))"
Normalize base=each

EXAMPLE 5: "Crossfade Interpolation" (Morphing)
// Create random frames and interpolate between them
NumFrames = 100
Seed = 12345
Wave start=0 end=0 "rand" // Noise at start
Wave start=99 end=99 "sin(2*pi*phase)" // Sine at end
// Fill frames 1-98 with morph
Interpolate Start=0 End=99 Type=crossfade
Spectrum lowest=0 highest=0 "0"
Normalize base=each
`;

        const UHM_SYSTEM_INSTRUCTION = `
You are UHM-GPT â€” a professional generator of 100% valid u-he Hive .uhm wavetable scripts.

Your output MUST ALWAYS:
- load successfully in Hive 2,
- stay within the verified-safe UHM subset,
- generate expressive, audible timbre with correct morphing,
- and never collapse into pure sine unless requested.

======================================================================
ABSOLUTE PARSER RULES (REVISED VIA OFFICIAL MANUAL)
======================================================================

1. Info string:
   - lowercase ascii only, max 3 words.
   Example: Info "airy choir pad"

2. Formulas MUST be single-line strings.

3. Allowed Commands:
   Info, NumFrames, Seed, Wave, Spectrum, Phase, 
   Normalize, Envelope, Interpolate, Move

4. Allowed Variables:
   phase (0-1), index (0-2047), frame, table (0-1), 
   x, y, pi, e, rand, randf, rands

5. Allowed Math Functions (Trig & DSP):
   - Basic: sin, cos, tan, sinh, cosh, tanh
   - Inverse: asin, acos, atan, atan2
   - Logic/Rounding: abs, ceil, floor, round, frac
   - Exponential: exp, log, log10, pow(x,y), sqrt
   - Conversion: lin_db, db_lin
   - DSP: lowpass(x, cut, res), highpass(x, cut, res), bandpass(x, cut, res)
   - Misc: select(cond, trueVal, falseVal), env(phase)

6. Allowed Operators:
   +, -, *, /, % (modulo), ^ (power)
   Comparisons: <, >, <=, >=, ==, != (return 1.0 or 0.0)

7. Waveform Blend Modes (blend=...):
   replace (default), add, sub, multiply, 
   min, max, divide

8. Forbidden / Dangerous:
   - Multi-line Wave expressions
   - Comments *inside* formula strings
   - smart quotes, unicode
   - "ass" substring (Hive parser bug)

9. Structure Requirement:
   Every script MUST end with:
   Spectrum lowest=0 highest=0 "0"
   Normalize base=each

======================================================================
INTELLIGENT SYNTHESIS ENGINE
======================================================================

UHM-GPT must decide automatically between synthesis methods:

----------------------------------------------------------------------
1. WAVE MODE (Subtractive / Distortion / FM)
----------------------------------------------------------------------
Use for: bass, growl, dirty, gritty, aggressive, analog.

Rules:
- Use 'lowpass', 'highpass', 'tanh', 'select' (ternary logic).
- Use 'Envelope' command to draw custom shapes if needed.
- Use 'Seed' to randomize noise if using 'rand'.

Template:
Info "<name>"
NumFrames = <N>
Seed = <random_int>
Wave start=0 end=<N-1> "<formula>"
(optional) Wave start=0 end=<N-1> blend=add "<layer>"
Spectrum lowest=0 highest=0 "0"
Normalize base=each

----------------------------------------------------------------------
2. SPECTRUM MODE (Additive / Pad / Vocal)
----------------------------------------------------------------------
Use for: choir, vocal, formant, glass, airy, ethereal.

Rules:
- Manipulate harmonics using 'index' (partial number).
- Create formants: "1/(abs(index-CUTOFF)+WIDTH)".
- Morph 'CUTOFF' using 'table' variable.

Template:
Info "<name>"
NumFrames = <N>
Spectrum start=0 end=<N-1> lowest=1 highest=1024 "<formula>"
Spectrum lowest=0 highest=0 "0"
Normalize base=each

======================================================================
OUTPUT FORMAT
======================================================================

1. Provide a one-sentence explanation.
2. Output exactly one .uhm code block.
3. No commentary after the code block.

${UHM_REFERENCE_LIBRARY}
`;

        // --- ENGINE ---

        window.initEngine = async () => {
            const initBtn = document.getElementById('init-btn');
            const statusContainer = document.getElementById('status-container');
            const statusText = document.getElementById('params-status');
            const progressText = document.getElementById('download-progress');

            initBtn.disabled = true;
            initBtn.innerText = "Initializing...";
            statusContainer.style.display = 'block';

            const initProgressCallback = (report) => {
                statusText.innerText = report.text;
                if (report.progress) {
                    progressText.innerText = `${(report.progress * 100).toFixed(1)}%`;
                }
            };

            try {
                statusText.innerText = "Connecting to GPU...";
                engine = await CreateMLCEngine(
                    SELECTED_MODEL,
                    { initProgressCallback: initProgressCallback }
                );

                statusText.innerText = "Engine Ready!";
                progressText.innerText = "";
                document.getElementById('init-section').style.display = 'none';
                document.getElementById('generator-interface').style.display = 'flex';

            } catch (err) {
                statusText.innerText = "Error: " + err.message;
                initBtn.disabled = false;
                initBtn.innerText = "Retry Initialize";
                console.error(err);
            }
        };

        window.generateUhm = async () => {
            const prompt = document.getElementById('prompt').value.trim();
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const errorBox = document.getElementById('errorBox');
            const resultSection = document.getElementById('resultSection');
            const codeOutput = document.getElementById('codeOutput');

            if (!prompt) {
                showError("Please describe your wavetable.");
                return;
            }

            // Reset UI
            errorBox.style.display = 'none';
            resultSection.style.display = 'none';
            btn.disabled = true;
            btnText.innerHTML = '<span class="loading-spinner"></span>Generating...';

            try {
                const messages = [
                    { role: "system", content: UHM_SYSTEM_INSTRUCTION },
                    { role: "user", content: "Description: " + prompt }
                ];

                const response = await engine.chat.completions.create({
                    messages,
                    stream: false,
                    temperature: 0.7
                });

                let text = response.choices[0].message.content || "";

                if (!text) throw new Error("No output generated.");

                // Cleanup Markdown Code Blocks
                if (text.includes("```")) {
                    const match = text.match(/```(?:javascript|js|uhm)?\s*([\s\S]*?)```/i);
                    text = match ? match[1] : text.replace(/```/g, '');
                }

                codeOutput.innerText = text.trim();
                resultSection.style.display = 'flex';

            } catch (err) {
                showError(err.message);
            } finally {
                btn.disabled = false;
                btnText.innerText = 'Generate .uhm Script';
            }
        };

        function showError(msg) {
            const errorBox = document.getElementById('errorBox');
            errorBox.innerText = `Error: ${msg}`;
            errorBox.style.display = 'block';
        }

        window.copyToClipboard = function () {
            const code = document.getElementById('codeOutput').innerText;
            navigator.clipboard.writeText(code).then(() => {
                alert("Code copied to clipboard!");
            });
        }

        window.downloadUhm = function () {
            const code = document.getElementById('codeOutput').innerText;
            // Extract Info name for filename
            const match = code.match(/Info "([^"]+)"/);
            let filename = "preset.uhm";
            if (match && match[1]) {
                filename = match[1].replace(/[^a-z0-9]/gi, '_').toLowerCase() + ".uhm";
            }

            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>

</html>
```